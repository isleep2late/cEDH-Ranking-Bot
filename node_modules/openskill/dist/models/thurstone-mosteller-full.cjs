"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/models/thurstone-mosteller-full.ts
var thurstone_mosteller_full_exports = {};
__export(thurstone_mosteller_full_exports, {
  default: () => thurstone_mosteller_full_default
});
module.exports = __toCommonJS(thurstone_mosteller_full_exports);

// src/util.ts
var import_ramda = require("ramda");

// src/constants.ts
var builder = (options) => {
  const { z = 3, mu = 25, preventSigmaIncrease = false, epsilon = 1e-4 } = options;
  const { tau = mu / 300, sigma = mu / z, beta = sigma / 2, limitSigma = preventSigmaIncrease } = options;
  const betaSq = beta ** 2;
  return {
    SIGMA: sigma,
    MU: mu,
    EPSILON: epsilon,
    TWOBETASQ: 2 * betaSq,
    BETA: beta,
    BETASQ: betaSq,
    Z: z,
    TAU: tau,
    LIMIT_SIGMA: limitSigma
  };
};
var constants_default = builder;

// src/util.ts
var sum = (a, b) => a + b;
var rankings = (teams, rank = []) => {
  const teamScores = teams.map((_, i) => rank[i] || i);
  const outRank = new Array(teams.length);
  let s = 0;
  for (let j = 0; j < teamScores.length; j += 1) {
    if (j > 0 && teamScores[j - 1] < teamScores[j]) {
      s = j;
    }
    outRank[j] = s;
  }
  return outRank;
};
var teamRating = (options) => (game) => {
  const rank = rankings(game, options.rank);
  return game.map((team, i) => [
    // mu[i]
    team.map(({ mu }) => mu).reduce(sum, 0),
    // sigma^2[i]
    team.map(({ sigma }) => sigma * sigma).reduce(sum, 0),
    // (original team data)
    team,
    // rank[i]
    rank[i]
  ]);
};
var utilC = (options) => {
  const { BETASQ } = constants_default(options);
  return (teamRatings) => Math.sqrt(teamRatings.map(([_teamMu, teamSigmaSq, _team, _rank]) => teamSigmaSq + BETASQ).reduce(sum, 0));
};
var gamma = (options) => {
  var _a;
  return (_a = options.gamma) != null ? _a : (
    // default to iSigma / c
    (c, _k, _mu, sigmaSq, _team, _qRank) => Math.sqrt(sigmaSq) / c
  );
};
var util_default = (options) => ({
  utilC: utilC(options),
  teamRating: teamRating(options),
  gamma: gamma(options)
});

// src/statistics.ts
var import_gaussian = __toESM(require("gaussian"), 1);
var normal = (0, import_gaussian.default)(0, 1);
var phiMajor = (x) => normal.cdf(x);
var phiMinor = (x) => normal.pdf(x);
var v = (x, t) => {
  const xt = x - t;
  const denom = phiMajor(xt);
  return denom < Number.EPSILON ? -xt : phiMinor(xt) / denom;
};
var w = (x, t) => {
  const xt = x - t;
  const denom = phiMajor(xt);
  if (denom < Number.EPSILON) {
    return x < 0 ? 1 : 0;
  }
  return v(x, t) * (v(x, t) + xt);
};
var vt = (x, t) => {
  const xx = Math.abs(x);
  const b = phiMajor(t - xx) - phiMajor(-t - xx);
  if (b < 1e-5) {
    if (x < 0) return -x - t;
    return -x + t;
  }
  const a = phiMinor(-t - xx) - phiMinor(t - xx);
  return (x < 0 ? -a : a) / b;
};
var wt = (x, t) => {
  const xx = Math.abs(x);
  const b = phiMajor(t - xx) - phiMajor(-t - xx);
  return b < Number.EPSILON ? 1 : ((t - xx) * phiMinor(t - xx) + (t + xx) * phiMinor(-t - xx)) / b + vt(x, t) * vt(x, t);
};

// src/models/thurstone-mosteller-full.ts
var model = (game, options = {}) => {
  const { TWOBETASQ, EPSILON } = constants_default(options);
  const { teamRating: teamRating2, gamma: gamma2 } = util_default(options);
  const teamRatings = teamRating2(game);
  return teamRatings.map((iTeamRating, i) => {
    const [iMu, iSigmaSq, iTeam, iRank] = iTeamRating;
    const [iOmega, iDelta] = teamRatings.filter((_, q) => i !== q).reduce(
      ([omega, delta], [qMu, qSigmaSq, _qTeam, qRank]) => {
        const ciq = Math.sqrt(iSigmaSq + qSigmaSq + TWOBETASQ);
        const deltaMu = (iMu - qMu) / ciq;
        const sigSqToCiq = iSigmaSq / ciq;
        const iGamma = gamma2(ciq, teamRatings.length, ...iTeamRating);
        if (qRank === iRank) {
          return [
            omega + sigSqToCiq * vt(deltaMu, EPSILON / ciq),
            delta + iGamma * sigSqToCiq / ciq * wt(deltaMu, EPSILON / ciq)
          ];
        }
        const sign = qRank > iRank ? 1 : -1;
        return [
          omega + sign * sigSqToCiq * v(sign * deltaMu, EPSILON / ciq),
          delta + iGamma * sigSqToCiq / ciq * w(sign * deltaMu, EPSILON / ciq)
        ];
      },
      [0, 0]
    );
    return iTeam.map(({ mu, sigma }) => {
      const sigmaSq = sigma * sigma;
      return {
        mu: mu + sigmaSq / iSigmaSq * iOmega,
        sigma: sigma * Math.sqrt(Math.max(1 - sigmaSq / iSigmaSq * iDelta, EPSILON))
      };
    });
  });
};
var thurstone_mosteller_full_default = model;
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL21vZGVscy90aHVyc3RvbmUtbW9zdGVsbGVyLWZ1bGwudHMiLCAiLi4vLi4vc3JjL3V0aWwudHMiLCAiLi4vLi4vc3JjL2NvbnN0YW50cy50cyIsICIuLi8uLi9zcmMvc3RhdGlzdGljcy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHV0aWwgZnJvbSAnLi4vdXRpbCdcbmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgdywgdiwgdnQsIHd0IH0gZnJvbSAnLi4vc3RhdGlzdGljcydcbmltcG9ydCB7IFJhdGluZywgT3B0aW9ucywgTW9kZWwgfSBmcm9tICcuLi90eXBlcydcblxuY29uc3QgbW9kZWw6IE1vZGVsID0gKGdhbWU6IFJhdGluZ1tdW10sIG9wdGlvbnM6IE9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IFRXT0JFVEFTUSwgRVBTSUxPTiB9ID0gY29uc3RhbnRzKG9wdGlvbnMpXG4gIGNvbnN0IHsgdGVhbVJhdGluZywgZ2FtbWEgfSA9IHV0aWwob3B0aW9ucylcbiAgY29uc3QgdGVhbVJhdGluZ3MgPSB0ZWFtUmF0aW5nKGdhbWUpXG5cbiAgcmV0dXJuIHRlYW1SYXRpbmdzLm1hcCgoaVRlYW1SYXRpbmcsIGkpID0+IHtcbiAgICBjb25zdCBbaU11LCBpU2lnbWFTcSwgaVRlYW0sIGlSYW5rXSA9IGlUZWFtUmF0aW5nXG4gICAgY29uc3QgW2lPbWVnYSwgaURlbHRhXSA9IHRlYW1SYXRpbmdzXG4gICAgICAuZmlsdGVyKChfLCBxKSA9PiBpICE9PSBxKVxuICAgICAgLnJlZHVjZShcbiAgICAgICAgKFtvbWVnYSwgZGVsdGFdLCBbcU11LCBxU2lnbWFTcSwgX3FUZWFtLCBxUmFua10pID0+IHtcbiAgICAgICAgICBjb25zdCBjaXEgPSBNYXRoLnNxcnQoaVNpZ21hU3EgKyBxU2lnbWFTcSArIFRXT0JFVEFTUSlcbiAgICAgICAgICBjb25zdCBkZWx0YU11ID0gKGlNdSAtIHFNdSkgLyBjaXFcbiAgICAgICAgICBjb25zdCBzaWdTcVRvQ2lxID0gaVNpZ21hU3EgLyBjaXFcbiAgICAgICAgICBjb25zdCBpR2FtbWEgPSBnYW1tYShjaXEsIHRlYW1SYXRpbmdzLmxlbmd0aCwgLi4uaVRlYW1SYXRpbmcpXG5cbiAgICAgICAgICBpZiAocVJhbmsgPT09IGlSYW5rKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICBvbWVnYSArIHNpZ1NxVG9DaXEgKiB2dChkZWx0YU11LCBFUFNJTE9OIC8gY2lxKSxcbiAgICAgICAgICAgICAgZGVsdGEgKyAoKGlHYW1tYSAqIHNpZ1NxVG9DaXEpIC8gY2lxKSAqIHd0KGRlbHRhTXUsIEVQU0lMT04gLyBjaXEpLFxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHNpZ24gPSBxUmFuayA+IGlSYW5rID8gMSA6IC0xXG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG9tZWdhICsgc2lnbiAqIHNpZ1NxVG9DaXEgKiB2KHNpZ24gKiBkZWx0YU11LCBFUFNJTE9OIC8gY2lxKSxcbiAgICAgICAgICAgIGRlbHRhICsgKChpR2FtbWEgKiBzaWdTcVRvQ2lxKSAvIGNpcSkgKiB3KHNpZ24gKiBkZWx0YU11LCBFUFNJTE9OIC8gY2lxKSxcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIFswLCAwXVxuICAgICAgKVxuXG4gICAgcmV0dXJuIGlUZWFtLm1hcCgoeyBtdSwgc2lnbWEgfSkgPT4ge1xuICAgICAgY29uc3Qgc2lnbWFTcSA9IHNpZ21hICogc2lnbWFcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG11OiBtdSArIChzaWdtYVNxIC8gaVNpZ21hU3EpICogaU9tZWdhLFxuICAgICAgICBzaWdtYTogc2lnbWEgKiBNYXRoLnNxcnQoTWF0aC5tYXgoMSAtIChzaWdtYVNxIC8gaVNpZ21hU3EpICogaURlbHRhLCBFUFNJTE9OKSksXG4gICAgICB9XG4gICAgfSlcbiAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgbW9kZWxcbiIsICJpbXBvcnQgeyB6aXAgfSBmcm9tICdyYW1kYSdcbmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnXG5pbXBvcnQgeyBSYXRpbmcsIE9wdGlvbnMsIEdhbW1hLCBUZWFtLCBSYW5rIH0gZnJvbSAnLi90eXBlcydcblxuZXhwb3J0IHR5cGUgVGVhbU11ID0gbnVtYmVyXG5cbmV4cG9ydCB0eXBlIFRlYW1TaWdtYVNxID0gbnVtYmVyXG5cbmV4cG9ydCB0eXBlIFRlYW1SYXRpbmcgPSBbVGVhbU11LCBUZWFtU2lnbWFTcSwgVGVhbSwgUmFua11cblxuZXhwb3J0IGNvbnN0IHN1bSA9IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gYSArIGJcblxuZXhwb3J0IGNvbnN0IHNjb3JlID0gKHE6IG51bWJlciwgaTogbnVtYmVyKSA9PiB7XG4gIGlmIChxIDwgaSkge1xuICAgIHJldHVybiAwLjBcbiAgfVxuICBpZiAocSA+IGkpIHtcbiAgICByZXR1cm4gMS4wXG4gIH1cbiAgLy8gcSA9PT0gaVxuICByZXR1cm4gMC41XG59XG5cbmV4cG9ydCBjb25zdCByYW5raW5ncyA9ICh0ZWFtczogVGVhbVtdLCByYW5rOiBudW1iZXJbXSA9IFtdKSA9PiB7XG4gIGNvbnN0IHRlYW1TY29yZXMgPSB0ZWFtcy5tYXAoKF8sIGkpID0+IHJhbmtbaV0gfHwgaSlcbiAgY29uc3Qgb3V0UmFuayA9IG5ldyBBcnJheSh0ZWFtcy5sZW5ndGgpXG5cbiAgbGV0IHMgPSAwXG4gIGZvciAobGV0IGogPSAwOyBqIDwgdGVhbVNjb3Jlcy5sZW5ndGg7IGogKz0gMSkge1xuICAgIGlmIChqID4gMCAmJiB0ZWFtU2NvcmVzW2ogLSAxXSA8IHRlYW1TY29yZXNbal0pIHtcbiAgICAgIHMgPSBqXG4gICAgfVxuICAgIG91dFJhbmtbal0gPSBzXG4gIH1cbiAgcmV0dXJuIG91dFJhbmtcbn1cblxuLy8gdGhpcyBpcyBiYXNpY2FsbHkgc2hhcmVkIGNvZGUsIHByZWNvbXB1dGVkIGZvciBldmVyeSBtb2RlbFxuY29uc3QgdGVhbVJhdGluZyA9XG4gIChvcHRpb25zOiBPcHRpb25zKSA9PlxuICAoZ2FtZTogVGVhbVtdKTogVGVhbVJhdGluZ1tdID0+IHtcbiAgICBjb25zdCByYW5rID0gcmFua2luZ3MoZ2FtZSwgb3B0aW9ucy5yYW5rKVxuICAgIHJldHVybiBnYW1lLm1hcCgodGVhbSwgaSkgPT4gW1xuICAgICAgLy8gbXVbaV1cbiAgICAgIHRlYW0ubWFwKCh7IG11IH0pID0+IG11KS5yZWR1Y2Uoc3VtLCAwKSxcbiAgICAgIC8vIHNpZ21hXjJbaV1cbiAgICAgIHRlYW0ubWFwKCh7IHNpZ21hIH0pID0+IHNpZ21hICogc2lnbWEpLnJlZHVjZShzdW0sIDApLFxuICAgICAgLy8gKG9yaWdpbmFsIHRlYW0gZGF0YSlcbiAgICAgIHRlYW0sXG4gICAgICAvLyByYW5rW2ldXG4gICAgICByYW5rW2ldLFxuICAgIF0pXG4gIH1cblxuZXhwb3J0IGNvbnN0IGxhZGRlclBhaXJzID0gPFQ+KHJhbmtzOiBUW10pOiBUW11bXSA9PiB7XG4gIGNvbnN0IHNpemUgPSByYW5rcy5sZW5ndGhcbiAgY29uc3QgbGVmdCA9IFt1bmRlZmluZWQsIC4uLnJhbmtzLnNsaWNlKDAsIHNpemUgLSAxKV1cbiAgY29uc3QgcmlnaHQgPSBbLi4ucmFua3Muc2xpY2UoMSksIHVuZGVmaW5lZF1cbiAgcmV0dXJuIHppcChsZWZ0LCByaWdodCkubWFwKChbbCwgcl0pID0+IHtcbiAgICBpZiAobCAhPT0gdW5kZWZpbmVkICYmIHIgIT09IHVuZGVmaW5lZCkgcmV0dXJuIFtsLCByXVxuICAgIGlmIChsICE9PSB1bmRlZmluZWQgJiYgciA9PT0gdW5kZWZpbmVkKSByZXR1cm4gW2xdXG4gICAgaWYgKGwgPT09IHVuZGVmaW5lZCAmJiByICE9PSB1bmRlZmluZWQpIHJldHVybiBbcl1cbiAgICByZXR1cm4gW10gLy8gdGhpcyBzaG91bGQgcmVhbGx5IG9ubHkgaGFwcGVuIHdoZW4gc2l6ZSA9PT0gMVxuICB9KVxufVxuXG5jb25zdCB1dGlsQyA9IChvcHRpb25zOiBPcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgQkVUQVNRIH0gPSBjb25zdGFudHMob3B0aW9ucylcbiAgcmV0dXJuICh0ZWFtUmF0aW5nczogVGVhbVJhdGluZ1tdKSA9PlxuICAgIE1hdGguc3FydCh0ZWFtUmF0aW5ncy5tYXAoKFtfdGVhbU11LCB0ZWFtU2lnbWFTcSwgX3RlYW0sIF9yYW5rXSkgPT4gdGVhbVNpZ21hU3EgKyBCRVRBU1EpLnJlZHVjZShzdW0sIDApKVxufVxuXG5leHBvcnQgY29uc3QgdXRpbFN1bVEgPSAodGVhbVJhdGluZ3M6IFRlYW1SYXRpbmdbXSwgYzogbnVtYmVyKSA9PlxuICB0ZWFtUmF0aW5ncy5tYXAoKFtfcU11LCBfcVNpZ21hU3EsIF9xVGVhbSwgcVJhbmtdKSA9PlxuICAgIHRlYW1SYXRpbmdzXG4gICAgICAuZmlsdGVyKChbX2lNdSwgX2lTaWdtYVNxLCBfaVRlYW0sIGlSYW5rXSkgPT4gaVJhbmsgPj0gcVJhbmspXG4gICAgICAubWFwKChbaU11LCBfaVNpZ21hU3EsIF9pVGVhbSwgX2lSYW5rXSkgPT4gTWF0aC5leHAoaU11IC8gYykpXG4gICAgICAucmVkdWNlKHN1bSwgMClcbiAgKVxuXG5leHBvcnQgY29uc3QgdXRpbEEgPSAodGVhbVJhdGluZ3M6IFRlYW1SYXRpbmdbXSkgPT5cbiAgdGVhbVJhdGluZ3MubWFwKFxuICAgIChbX2lNdSwgX2lTaWdtYVNxLCBfaVRlYW0sIGlSYW5rXSkgPT5cbiAgICAgIHRlYW1SYXRpbmdzLmZpbHRlcigoW19xTXUsIF9xU2lnbWFTcSwgX3FUZWFtLCBxUmFua10pID0+IGlSYW5rID09PSBxUmFuaykubGVuZ3RoXG4gIClcblxuZXhwb3J0IGNvbnN0IGdhbW1hID0gKG9wdGlvbnM6IE9wdGlvbnMpOiBHYW1tYSA9PlxuICBvcHRpb25zLmdhbW1hID8/XG4gIC8vIGRlZmF1bHQgdG8gaVNpZ21hIC8gY1xuICAoKGM6IG51bWJlciwgX2s6IG51bWJlciwgX211OiBudW1iZXIsIHNpZ21hU3E6IG51bWJlciwgX3RlYW06IFJhdGluZ1tdLCBfcVJhbms6IG51bWJlcikgPT4gTWF0aC5zcXJ0KHNpZ21hU3EpIC8gYylcblxuZXhwb3J0IGRlZmF1bHQgKG9wdGlvbnM6IE9wdGlvbnMpID0+ICh7XG4gIHV0aWxDOiB1dGlsQyhvcHRpb25zKSxcbiAgdGVhbVJhdGluZzogdGVhbVJhdGluZyhvcHRpb25zKSxcbiAgZ2FtbWE6IGdhbW1hKG9wdGlvbnMpLFxufSlcbiIsICJpbXBvcnQgeyBPcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuY29uc3QgYnVpbGRlciA9IChvcHRpb25zOiBPcHRpb25zKSA9PiB7XG4gIC8vIGknZCBsb3ZlIHRvIGtub3cgb2YgYSBiZXR0ZXIgd2F5IHRvIGRvIHRoaXNcbiAgY29uc3QgeyB6ID0gMywgbXUgPSAyNSwgcHJldmVudFNpZ21hSW5jcmVhc2UgPSBmYWxzZSwgZXBzaWxvbiA9IDAuMDAwMSB9ID0gb3B0aW9uc1xuICBjb25zdCB7IHRhdSA9IG11IC8gMzAwLCBzaWdtYSA9IG11IC8geiwgYmV0YSA9IHNpZ21hIC8gMiwgbGltaXRTaWdtYSA9IHByZXZlbnRTaWdtYUluY3JlYXNlIH0gPSBvcHRpb25zXG4gIGNvbnN0IGJldGFTcSA9IGJldGEgKiogMlxuXG4gIHJldHVybiB7XG4gICAgU0lHTUE6IHNpZ21hLFxuICAgIE1VOiBtdSxcbiAgICBFUFNJTE9OOiBlcHNpbG9uLFxuICAgIFRXT0JFVEFTUTogMiAqIGJldGFTcSxcbiAgICBCRVRBOiBiZXRhLFxuICAgIEJFVEFTUTogYmV0YVNxLFxuICAgIFo6IHosXG4gICAgVEFVOiB0YXUsXG4gICAgTElNSVRfU0lHTUE6IGxpbWl0U2lnbWEsXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgYnVpbGRlclxuIiwgImltcG9ydCBnYXVzc2lhbiBmcm9tICdnYXVzc2lhbidcblxuLy8gdXNlIGEgc3RhbmRhcmQgbm9ybWFsIGRpc3RyaWJ1dGlvbiAtIG1lYW4gb2YgemVybywgc3RkZGV2L3ZhcmlhbmNlIG9mIG9uZVxuY29uc3Qgbm9ybWFsID0gZ2F1c3NpYW4oMCwgMSlcblxuZXhwb3J0IGNvbnN0IHBoaU1ham9yID0gKHg6IG51bWJlcikgPT4gbm9ybWFsLmNkZih4KVxuXG5leHBvcnQgY29uc3QgcGhpTWFqb3JJbnZlcnNlID0gKHg6IG51bWJlcikgPT4gbm9ybWFsLnBwZih4KVxuXG5leHBvcnQgY29uc3QgcGhpTWlub3IgPSAoeDogbnVtYmVyKSA9PiBub3JtYWwucGRmKHgpXG5cbmV4cG9ydCBjb25zdCB2ID0gKHg6IG51bWJlciwgdDogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IHh0ID0geCAtIHRcbiAgY29uc3QgZGVub20gPSBwaGlNYWpvcih4dClcbiAgcmV0dXJuIGRlbm9tIDwgTnVtYmVyLkVQU0lMT04gPyAteHQgOiBwaGlNaW5vcih4dCkgLyBkZW5vbVxufVxuXG5leHBvcnQgY29uc3QgdyA9ICh4OiBudW1iZXIsIHQ6IG51bWJlcikgPT4ge1xuICBjb25zdCB4dCA9IHggLSB0XG4gIGNvbnN0IGRlbm9tID0gcGhpTWFqb3IoeHQpXG4gIGlmIChkZW5vbSA8IE51bWJlci5FUFNJTE9OKSB7XG4gICAgcmV0dXJuIHggPCAwID8gMSA6IDBcbiAgfVxuICByZXR1cm4gdih4LCB0KSAqICh2KHgsIHQpICsgeHQpXG59XG5cbmV4cG9ydCBjb25zdCB2dCA9ICh4OiBudW1iZXIsIHQ6IG51bWJlcikgPT4ge1xuICBjb25zdCB4eCA9IE1hdGguYWJzKHgpXG4gIGNvbnN0IGIgPSBwaGlNYWpvcih0IC0geHgpIC0gcGhpTWFqb3IoLXQgLSB4eClcbiAgaWYgKGIgPCAxZS01KSB7XG4gICAgaWYgKHggPCAwKSByZXR1cm4gLXggLSB0XG4gICAgcmV0dXJuIC14ICsgdFxuICB9XG4gIGNvbnN0IGEgPSBwaGlNaW5vcigtdCAtIHh4KSAtIHBoaU1pbm9yKHQgLSB4eClcbiAgcmV0dXJuICh4IDwgMCA/IC1hIDogYSkgLyBiXG59XG5cbmV4cG9ydCBjb25zdCB3dCA9ICh4OiBudW1iZXIsIHQ6IG51bWJlcikgPT4ge1xuICBjb25zdCB4eCA9IE1hdGguYWJzKHgpXG4gIGNvbnN0IGIgPSBwaGlNYWpvcih0IC0geHgpIC0gcGhpTWFqb3IoLXQgLSB4eClcbiAgcmV0dXJuIGIgPCBOdW1iZXIuRVBTSUxPTlxuICAgID8gMS4wXG4gICAgOiAoKHQgLSB4eCkgKiBwaGlNaW5vcih0IC0geHgpICsgKHQgKyB4eCkgKiBwaGlNaW5vcigtdCAtIHh4KSkgLyBiICsgdnQoeCwgdCkgKiB2dCh4LCB0KVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7O0FDQUEsbUJBQW9COzs7QUNFcEIsSUFBTSxVQUFVLENBQUMsWUFBcUI7QUFFcEMsUUFBTSxFQUFFLElBQUksR0FBRyxLQUFLLElBQUksdUJBQXVCLE9BQU8sVUFBVSxLQUFPLElBQUk7QUFDM0UsUUFBTSxFQUFFLE1BQU0sS0FBSyxLQUFLLFFBQVEsS0FBSyxHQUFHLE9BQU8sUUFBUSxHQUFHLGFBQWEscUJBQXFCLElBQUk7QUFDaEcsUUFBTSxTQUFTLFFBQVE7QUFFdkIsU0FBTztBQUFBLElBQ0wsT0FBTztBQUFBLElBQ1AsSUFBSTtBQUFBLElBQ0osU0FBUztBQUFBLElBQ1QsV0FBVyxJQUFJO0FBQUEsSUFDZixNQUFNO0FBQUEsSUFDTixRQUFRO0FBQUEsSUFDUixHQUFHO0FBQUEsSUFDSCxLQUFLO0FBQUEsSUFDTCxhQUFhO0FBQUEsRUFDZjtBQUNGO0FBRUEsSUFBTyxvQkFBUTs7O0FEWFIsSUFBTSxNQUFNLENBQUMsR0FBVyxNQUFjLElBQUk7QUFhMUMsSUFBTSxXQUFXLENBQUMsT0FBZSxPQUFpQixDQUFDLE1BQU07QUFDOUQsUUFBTSxhQUFhLE1BQU0sSUFBSSxDQUFDLEdBQUcsTUFBTSxLQUFLLENBQUMsS0FBSyxDQUFDO0FBQ25ELFFBQU0sVUFBVSxJQUFJLE1BQU0sTUFBTSxNQUFNO0FBRXRDLE1BQUksSUFBSTtBQUNSLFdBQVMs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TyxVQUNkLE1BQ0UsSUFBSSxNQUFNLFNBQVMsSUFBSSxFQUFFLEtBQUssSUFBSSxNQUFNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7QUFDM0Y7OztBSHRDQSxJQUFNLFFBQWUsQ0FBQyxNQUFrQixVQUFtQixDQUFDLE1BQU07QUFDaEUsUUFBTSxFQUFFLFdBQVcsUUFBUSxJQUFJLGtCQUFVLE9BQU87QUFDaEQsUUFBTSxFQUFFLFlBQUFDLGFBQVksT0FBQUMsT0FBTSxJQUFJLGFBQUssT0FBTztBQUMxQyxRQUFNLGNBQWNELFlBQVcsSUFBSTtBQUVuQyxTQUFPLFlBQVksSUFBSSxDQUFDLGFBQWEsTUFBTTtBQUN6QyxVQUFNLENBQUMsS0FBSyxVQUFVLE9BQU8sS0FBSyxJQUFJO0FBQ3RDLFVBQU0sQ0FBQyxRQUFRLE1BQU0sSUFBSSxZQUN0QixPQUFPLENBQUMsR0FBRyxNQUFNLE1BQU0sQ0FBQyxFQUN4QjtBQUFBLE1BQ0MsQ0FBQyxDQUFDLE9BQU8sS0FBSyxHQUFHLENBQUMsS0FBSyxVQUFVLFFBQVEsS0FBSyxNQUFNO0FBQ2xELGNBQU0sTUFBTSxLQUFLLEtBQUssV0FBVyxXQUFXLFNBQVM7QUFDckQsY0FBTSxXQUFXLE1BQU0sT0FBTztBQUM5QixjQUFNLGFBQWEsV0FBVztBQUM5QixjQUFNLFNBQVNDLE9BQU0sS0FBSyxZQUFZLFFBQVEsR0FBRyxXQUFXO0FBRTVELFlBQUksVUFBVSxPQUFPO0FBQ25CLGlCQUFPO0FBQUEsWUFDTCxRQUFRLGFBQWEsR0FBRyxTQUFTLFVBQVUsR0FBRztBQUFBLFlBQzlDLFFBQVUsU0FBUyxhQUFjLE1BQU8sR0FBRyxTQUFTLFVBQVUsR0FBRztBQUFBLFVBQ25FO0FBQUEsUUFDRjtBQUVBLGNBQU0sT0FBTyxRQUFRLFFBQVEsSUFBSTtBQUNqQyxlQUFPO0FBQUEsVUFDTCxRQUFRLE9BQU8sYUFBYSxFQUFFLE9BQU8sU0FBUyxVQUFVLEdBQUc7QUFBQSxVQUMzRCxRQUFVLFNBQVMsYUFBYyxNQUFPLEVBQUUsT0FBTyxTQUFTLFVBQVUsR0FBRztBQUFBLFFBQ3pFO0FBQUEsTUFDRjtBQUFBLE1BQ0EsQ0FBQyxHQUFHLENBQUM7QUFBQSxJQUNQO0FBRUYsV0FBTyxNQUFNLElBQUksQ0FBQyxFQUFFLElBQUksTUFBTSxNQUFNO0FBQ2xDLFlBQU0sVUFBVSxRQUFRO0FBQ3hCLGFBQU87QUFBQSxRQUNMLElBQUksS0FBTSxVQUFVLFdBQVk7QUFBQSxRQUNoQyxPQUFPLFFBQVEsS0FBSyxLQUFLLEtBQUssSUFBSSxJQUFLLFVBQVUsV0FBWSxRQUFRLE9BQU8sQ0FBQztBQUFBLE1BQy9FO0FBQUEsSUFDRixDQUFDO0FBQUEsRUFDSCxDQUFDO0FBQ0g7QUFFQSxJQUFPLG1DQUFROyIsCiAgIm5hbWVzIjogWyJnYXVzc2lhbiIsICJ0ZWFtUmF0aW5nIiwgImdhbW1hIl0KfQo=